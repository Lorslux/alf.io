<p>api-key-system works!</p>
<div class="container">
  <h1 class="my-3">System API Key</h1>
  <p>
    System API Key can be used from external application to create/modify/delete
    organizations and to create API Keys
  </p>
  <hr />

  <div class="d-flex py-3">
    <select
      id="UserOrganizationId"
      class="form-select form-control d-flex mx-3"
      [(ngModel)]="selectedOrganization"
    >
      <option></option>
      <option *ngFor="let org of organizations$ | async" [ngValue]="org">
        {{ org.name }}
      </option>
    </select>
    <div ngbDropdown class="d-inline-block d-flex mx-3">
      <button
        type="button"
        class="btn btn-outline-primary"
        id="dropdownBasic1"
        ngbDropdownToggle
      >
        Download all API Keys for
      </button>
      <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
        <button
          (click)="downloadAllApiKeys(org.id)"
          *ngFor="let org of organizations$ | async"
          ngbDropdownItem
        >
          {{ org.name }}
        </button>
      </div>
      <a
        class="btn btn-warning mx-3"
        [routerLink]="['/access-control/api-keys/bulk']"
      >
        <svg-icon key="groups"></svg-icon>Bulk creation
      </a>
      <button
        type="button"
        class="btn btn-success d-flex align-items-center mx-3"
        [routerLink]="['/access-control/api-keys/new']"
      >
        <svg-icon key="add" class="d-flex align-items-center"></svg-icon>
        add new
      </button>
    </div>
  </div>

  <div class="container">
    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">Api key</th>
          <th scope="col">Description</th>
          <th scope="col">Role</th>
          <th scope="col">Member of</th>
          <th scope="col">QR Code</th>
          <th scope="col">Edit</th>
          <th scope="col">Enable / Disable</th>
          <th scope="col">Delete</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="
            let user of users$ | async | usersFilterOrg : selectedOrganization
          "
        >
          <td>{{ user.username }}</td>
          <td>
            <span *ngFor="let org of user.memberOf">
              {{ org.description }}
            </span>
          </td>
          <td>
            <span *ngFor="let role of user.roles">{{
              roleDescription(role) | async
            }}</span>
          </td>
          <td>
            <span *ngFor="let org of user.memberOf" class="badge bg-primary">{{
              org.name
            }}</span>
          </td>
          <td>view qr code</td>
          <td>
            <a
              [routerLink]="['/access-control/api-keys', user.id, 'edit']"
              class="btn"
              *ngIf="user.enabled"
              (click)="enable(user)"
              ><svg-icon key="edit" size="lg"></svg-icon
            ></a>
          </td>
          <td>
            <button
              *ngIf="user.enabled"
              class="btn btn-warning"
              (click)="enable(user)"
            >
              <svg-icon key="visibilityoff"></svg-icon>

              Disable
            </button>
            <button
              *ngIf="!user.enabled"
              class="btn btn-success"
              (click)="enable(user)"
            >
              <svg-icon key="visibility-on"></svg-icon>

              Enable
            </button>
          </td>

          <td>
            <button class="btn btn-danger" (click)="deleteUserApikey(user)">
              <svg-icon key="delete"></svg-icon>
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
